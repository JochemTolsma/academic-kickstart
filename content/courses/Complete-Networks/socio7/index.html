---
title: RSiena II (consequences)
author: JochemTolsma
date: '2020-09-22'
slug: socio7
categories:
  - R
  - Social Networks
tags: []
linktitle: Socionets-Consequences-Methods
summary: "RSiena, twitter, social networks, plotting, tutorial, R, Lavaan"
lastmod: '2020-09-15T08:27:34+02:00'
type: book
weight: 47
 
output:
  blogdown::html_page:
    highlight: "haddock"
    number_sections: yes
    self_contained: no
    toc: true
    fig_width: 6
    dev: "svg"
editor_options: 
  chunk_output_type: inline
---

<script src="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/accessible-code-block/empty-anchor.js"></script>
<link href="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/anchor-sections/anchor-sections.js"></script>
<script src="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/clipboard/clipboard.min.js"></script>
<link href="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/primer-tooltips/build.css" rel="stylesheet" />
<link href="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/klippy/css/klippy.min.css" rel="stylesheet" />
<script src="{{< relref "courses/Complete-Networks/socio7/index.html" >}}index_files/klippy/js/klippy.min.js"></script>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#introduction---rsiena-behaviour"><span class="toc-section-number">1</span> Introduction - RSiena behaviour</a></li>
<li><a href="#rsiena---some-additional-explanations"><span class="toc-section-number">2</span> RSiena - some additional explanations</a><ul>
<li><a href="#modelling-node-evolution"><span class="toc-section-number">2.1</span> modelling node evolution</a><ul>
<li><a href="#rsiena-linear-and-quad-effects"><span class="toc-section-number">2.1.1</span> RSiena-linear and quad effects</a></li>
<li><a href="#multi-level-hybrid-model"><span class="toc-section-number">2.1.2</span> Multi-level hybrid model</a></li>
</ul></li>
<li><a href="#avalt-and-totalt-effects"><span class="toc-section-number">2.2</span> avAlt and totAlt effects</a></li>
<li><a href="#alt-versus-inalt-effects"><span class="toc-section-number">2.3</span> …Alt versus …InAlt effects</a></li>
</ul></li>
<li><a href="#lab-exercise"><span class="toc-section-number">3</span> lab exercise</a><ul>
<li><a href="#before-you-start"><span class="toc-section-number">3.1</span> Before you start</a></li>
<li><a href="#data"><span class="toc-section-number">3.2</span> Data</a></li>
<li><a href="#descriptive-statistics-of-similarity-in-behavior"><span class="toc-section-number">3.3</span> Descriptive statistics of similarity in behavior</a><ul>
<li><a href="#formula"><span class="toc-section-number">3.3.1</span> formula</a></li>
<li><a href="#morans-autocorrelation-for-outgoing-ties-rsiena-build-in-dataset"><span class="toc-section-number">3.3.2</span> Moran’s autocorrelation for outgoing ties: RSiena build-in dataset</a></li>
<li><a href="#morans-autocorrelation-for-outgoing-ties-mymovez-dataset"><span class="toc-section-number">3.3.3</span> Moran’s autocorrelation for outgoing ties: MyMovez dataset</a></li>
</ul></li>
<li><a href="#a-quick-co-evolution-rsiena-model-to-check."><span class="toc-section-number">3.4</span> A quick co-evolution RSiena model to check.</a></li>
</ul></li>
<li><a href="#assignment"><span class="toc-section-number">4</span> Assignment</a><ul>
<li><a href="#testing-and-finding-optimal-model"><span class="toc-section-number">4.1</span> testing and finding optimal model</a><ul>
<li><a href="#sienaalgorithm"><span class="toc-section-number">4.1.1</span> sienaAlgorithm</a></li>
<li><a href="#select-only-one-class"><span class="toc-section-number">4.1.2</span> select only one class</a></li>
</ul></li>
<li><a href="#an-example-on-the-mymovez-dataset"><span class="toc-section-number">4.2</span> An example on the MyMovez dataset</a></li>
</ul></li>
</ul>
</div>

<!--set global settings-->
<!--copy to clipboard-->
<p><script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<!---
https://www.w3schools.com/w3css/w3css_buttons.asp
https://www.freecodecamp.org/news/a-quick-guide-to-styling-buttons-using-css-f64d4f96337f/
---></p>
<button onclick="window.location.href=&#39;static/index.Rmd&#39;;">
download code
</button>
<div id="introduction---rsiena-behaviour" class="section level1">
<h1><span class="header-section-number">1</span> Introduction - RSiena behaviour</h1>
<p>This page will teach you how to use the R package RSiena for modeling behavioral change. Thus on this page we will focus on node evolution and influence processes.<br />
Please visit the RSiena homepage <a href="https://www.stats.ox.ac.uk/~snijders/siena/">here</a>. On the website you may find the exceptionally well written manual. But the RSiena website also contains all kind of useful RSiena scripts and ‘lab exercises’.
When we model both tie-evolution (which is what we almost without exception do with RSiena) and node-evolution, we also call this a co-evolution model.
Before we start with our own lab exercise, I would like you to:</p>
<ol style="list-style-type: decimal">
<li>walk through script number 6 on the RSiena website (which is called <a href="https://www.stats.ox.ac.uk/~snijders/siena/Rscript04SienaBehaviour.R">Rscript04SienaBehaviour.R</a>).</li>
</ol>
<p>My own lab exercise can be found <a href="#lab-exercise">below</a>.</p>
</div>
<div id="rsiena---some-additional-explanations" class="section level1">
<h1><span class="header-section-number">2</span> RSiena - some additional explanations</h1>
<p>Having taught the course social networks for a couple of years now to the students of the Research Master Social and Cultural Sciences, I think there are a couple of aspects that deserve a little bit more attention than they get in the manual and on the RSiena website. Namely,…</p>
<ol style="list-style-type: decimal">
<li>How do we model node evolution and are results similar to ‘normal’ regression models?<br />
</li>
<li>What is the difference between an average alter effect and a total alter effect?</li>
<li>Can senders only influence receivers or also vice versa? Do we need both in our models?</li>
</ol>
<div id="modelling-node-evolution" class="section level2">
<h2><span class="header-section-number">2.1</span> modelling node evolution</h2>
<div id="rsiena-linear-and-quad-effects" class="section level3">
<h3><span class="header-section-number">2.1.1</span> RSiena-linear and quad effects</h3>
</div>
<div id="multi-level-hybrid-model" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Multi-level hybrid model</h3>
</div>
</div>
<div id="avalt-and-totalt-effects" class="section level2">
<h2><span class="header-section-number">2.2</span> avAlt and totAlt effects</h2>
<p>I think this question deserves a knowledge clip. Please watch the video below.</p>
<iframe src="https://player.vimeo.com/video/465727691" width="640" height="360" frameborder="0" allow="autoplay; fullscreen" allowfullscreen>
</iframe>
<p>{{% alert note %}}
After having watched the video you have learned:</p>
<ol style="list-style-type: decimal">
<li>You may be influenced by (the absence of) ties in the network, regardless of the node attributes.<br />
</li>
<li>You may be influenced by others to whom you are connected via an undirected tie, an outgoing tie, and an ingoing tie.<br />
</li>
<li>The difference between average alter and total alter effects.<br />
</li>
<li>That (positive) influence may also mean that you become similar to an alter to which you are connected with a specific node attribute but thereby become less similar to more other alters to which you are also connected.
{{% /alert %}}</li>
</ol>
<div class="figure"><span id="fig:influence"></span>
<img src="Plot2.PNG" alt="Average Alter Effect" width="100%" />
<p class="caption">
Figure 2.1: Average Alter Effect
</p>
</div>
<div class="figure"><span id="fig:influence2"></span>
<img src="Plot3.PNG" alt="Total Alter Effect" width="100%" />
<p class="caption">
Figure 2.2: Total Alter Effect
</p>
</div>
</div>
<div id="alt-versus-inalt-effects" class="section level2">
<h2><span class="header-section-number">2.3</span> …Alt versus …InAlt effects</h2>
<p>Have a look at the picture below.</p>
<div class="figure"><span id="fig:influence3"></span>
<img src="plot1.PNG" alt="Who is influencing whom?" width="100%" />
<p class="caption">
Figure 2.3: Who is influencing whom?
</p>
</div>
<ul>
<li>Undirectied tie: The direction of influence does not depend on the direction tie. In RSiena who is influenced depends on who has the opportunity for change (thus by the behavioral rate function)<br />
</li>
<li>Directed tie <em>i</em> –&gt; <em>j</em>. Actor <em>j</em> may assimilate to <em>i</em> because of an incoming tie. In RSiena these effects are …inAlt effects (e.g. effects <span class="math inline">\(s^{beh}_{i20}\)</span> and <span class="math inline">\(s^{beh}_{i21}\)</span>). Example 1a: I teach you how to apply a social network perspective in your research, you come to value a social network perspective and your research behavior becomes more similar to mine.<br />
</li>
<li>Directed tie <em>i</em> –&gt; <em>j</em>. Actor <em>i</em> may assimilate to <em>j</em> because of an outgoing tie. In RSiena these effects are …Alt effects (e.g. effects <span class="math inline">\(s^{beh}_{i18}\)</span> and <span class="math inline">\(s^{beh}_{i19}\)</span>). Example 2a: I name you as my friend and therefore I will mimic your behavior.</li>
</ul>
<p>Naturally, the influence may also be negative:
Example 1b: I teach you how to apply a social network perspective in your research, you come to dislike a social network perspective and your research behavior becomes less similar to mine.<br />
Example 2b: I name you as my foe and therefore I will behave as different as possible from you.</p>
<p>The question is, can we tease these processes apart and can we tell which one is more important? To be honest, I am not sure. But we will try below.</p>
</div>
</div>
<div id="lab-exercise" class="section level1">
<h1><span class="header-section-number">3</span> lab exercise</h1>
<p>We are going to use data collected among primary and secondary school pupils in the Netherlands during the <a href="http://mymovez.eu/">MyMovez</a> project.</p>
<p>During the workgroup I will explain all code. For those of you who don’t attend the workgroups, google knows way more than I do.</p>
<p>{{% alert warning %}}
In the upper left and right corner of the code blocks you will find copy-to-clipboard buttons. Use these buttons to copy the code to your own editor.
{{% /alert %}}</p>
<div id="before-you-start" class="section level2">
<h2><span class="header-section-number">3.1</span> Before you start</h2>
<p>Before you start, check whether you run the latest RStudio version (from the Help menu, pick ‘check for updates’ and whether you need to update R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;installr&quot;</span>)  <span class="co">#you  first install packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">require</span>(installr)  <span class="co">#then you will need to activate packages. </span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">updateR</span>()  <span class="co">#run the function to start the update process</span></span></code></pre></div>
<p>Give your script a nice name. Include the author, and data when you last modified the script. Include a lot of comments in your script! Don’t forget, always start with cleaning up your workspace.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">### Author: JOCHEM TOLSMA### Lastmod: 31-08-2020###</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># cleanup workspace</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span></code></pre></div>
<p>And set your working directory.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># set working directory</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">setwd</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">YOURDIR</span><span class="ch">\\</span><span class="st">YOURSUBDIR</span><span class="ch">\\</span><span class="st">YOURSUBSUBDIR</span><span class="ch">\\</span><span class="st">&quot;</span>)  <span class="co">#change to your own workdirectory</span></span></code></pre></div>
<p>Install the packages you will need.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">library</span>(RSiena)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">library</span>(sna)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">library</span>(ape)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">library</span>(network)</span></code></pre></div>
<p>Define your custom build functions.</p>
<p><code>fMoran.I</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>fMoran.I &lt;-<span class="st"> </span><span class="cf">function</span>(x, weight, <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="dt">rowstandardize =</span> <span class="ot">TRUE</span>) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="cf">if</span> (rowstandardize) {</span>
<span id="cb5-3"><a href="#cb5-3"></a>        <span class="cf">if</span> (<span class="kw">dim</span>(weight)[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> </span><span class="kw">dim</span>(weight)[<span class="dv">2</span>]) </span>
<span id="cb5-4"><a href="#cb5-4"></a>            <span class="kw">stop</span>(<span class="st">&quot;&#39;weight&#39; must be a square matrix&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>        n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb5-6"><a href="#cb5-6"></a>        <span class="cf">if</span> (<span class="kw">dim</span>(weight)[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> </span>n) </span>
<span id="cb5-7"><a href="#cb5-7"></a>            <span class="kw">stop</span>(<span class="st">&quot;&#39;weight&#39; must have as many rows as observations in &#39;x&#39;&quot;</span>)</span>
<span id="cb5-8"><a href="#cb5-8"></a>        ei &lt;-<span class="st"> </span><span class="dv">-1</span><span class="op">/</span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a>        nas &lt;-<span class="st"> </span><span class="kw">is.na</span>(x)</span>
<span id="cb5-10"><a href="#cb5-10"></a>        <span class="cf">if</span> (<span class="kw">any</span>(nas)) {</span>
<span id="cb5-11"><a href="#cb5-11"></a>            <span class="cf">if</span> (na.rm) {</span>
<span id="cb5-12"><a href="#cb5-12"></a>                x &lt;-<span class="st"> </span>x[<span class="op">!</span>nas]</span>
<span id="cb5-13"><a href="#cb5-13"></a>                n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb5-14"><a href="#cb5-14"></a>                weight &lt;-<span class="st"> </span>weight[<span class="op">!</span>nas, <span class="op">!</span>nas]</span>
<span id="cb5-15"><a href="#cb5-15"></a>            } <span class="cf">else</span> {</span>
<span id="cb5-16"><a href="#cb5-16"></a>                <span class="kw">warning</span>(<span class="st">&quot;&#39;x&#39; has missing values: maybe you wanted to set na.rm = TRUE?&quot;</span>)</span>
<span id="cb5-17"><a href="#cb5-17"></a>                <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">observed =</span> <span class="ot">NA</span>, <span class="dt">expected =</span> ei, <span class="dt">sd =</span> <span class="ot">NA</span>, <span class="dt">p.value =</span> <span class="ot">NA</span>))</span>
<span id="cb5-18"><a href="#cb5-18"></a>            }</span>
<span id="cb5-19"><a href="#cb5-19"></a>        }</span>
<span id="cb5-20"><a href="#cb5-20"></a>        ROWSUM &lt;-<span class="st"> </span><span class="kw">rowSums</span>(weight)</span>
<span id="cb5-21"><a href="#cb5-21"></a>        ROWSUM[ROWSUM <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>        weight &lt;-<span class="st"> </span>weight<span class="op">/</span>ROWSUM</span>
<span id="cb5-23"><a href="#cb5-23"></a>        s &lt;-<span class="st"> </span><span class="kw">sum</span>(weight)</span>
<span id="cb5-24"><a href="#cb5-24"></a>        m &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb5-25"><a href="#cb5-25"></a>        y &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span>m</span>
<span id="cb5-26"><a href="#cb5-26"></a>        cv &lt;-<span class="st"> </span><span class="kw">sum</span>(weight <span class="op">*</span><span class="st"> </span>y <span class="op">%o%</span><span class="st"> </span>y)</span>
<span id="cb5-27"><a href="#cb5-27"></a>        v &lt;-<span class="st"> </span><span class="kw">sum</span>(y<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-28"><a href="#cb5-28"></a>        obs &lt;-<span class="st"> </span>(n<span class="op">/</span>s) <span class="op">*</span><span class="st"> </span>(cv<span class="op">/</span>v)</span>
<span id="cb5-29"><a href="#cb5-29"></a>        <span class="cf">if</span> (scaled) {</span>
<span id="cb5-30"><a href="#cb5-30"></a>            i.max &lt;-<span class="st"> </span>(n<span class="op">/</span>s) <span class="op">*</span><span class="st"> </span>(<span class="kw">sd</span>(<span class="kw">rowSums</span>(weight) <span class="op">*</span><span class="st"> </span>y)<span class="op">/</span><span class="kw">sqrt</span>(v<span class="op">/</span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)))</span>
<span id="cb5-31"><a href="#cb5-31"></a>            obs &lt;-<span class="st"> </span>obs<span class="op">/</span>i.max</span>
<span id="cb5-32"><a href="#cb5-32"></a>        }</span>
<span id="cb5-33"><a href="#cb5-33"></a>        S1 &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((weight <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(weight))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-34"><a href="#cb5-34"></a>        S2 &lt;-<span class="st"> </span><span class="kw">sum</span>((<span class="kw">apply</span>(weight, <span class="dv">1</span>, sum) <span class="op">+</span><span class="st"> </span><span class="kw">apply</span>(weight, <span class="dv">2</span>, sum))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-35"><a href="#cb5-35"></a>        s.sq &lt;-<span class="st"> </span>s<span class="op">^</span><span class="dv">2</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>        k &lt;-<span class="st"> </span>(<span class="kw">sum</span>(y<span class="op">^</span><span class="dv">4</span>)<span class="op">/</span>n)<span class="op">/</span>(v<span class="op">/</span>n)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>        sdi &lt;-<span class="st"> </span><span class="kw">sqrt</span>((n <span class="op">*</span><span class="st"> </span>((n<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>S1 <span class="op">-</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span>S2 <span class="op">+</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>s.sq) <span class="op">-</span><span class="st"> </span>k <span class="op">*</span><span class="st"> </span>(n <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>S1 <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span></span>
<span id="cb5-38"><a href="#cb5-38"></a><span class="st">            </span>S2 <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">*</span><span class="st"> </span>s.sq))<span class="op">/</span>((n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>s.sq) <span class="op">-</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>((n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb5-39"><a href="#cb5-39"></a>        alternative &lt;-<span class="st"> </span><span class="kw">match.arg</span>(alternative, <span class="kw">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;less&quot;</span>, <span class="st">&quot;greater&quot;</span>))</span>
<span id="cb5-40"><a href="#cb5-40"></a>        pv &lt;-<span class="st"> </span><span class="kw">pnorm</span>(obs, <span class="dt">mean =</span> ei, <span class="dt">sd =</span> sdi)</span>
<span id="cb5-41"><a href="#cb5-41"></a>        <span class="cf">if</span> (alternative <span class="op">==</span><span class="st"> &quot;two.sided&quot;</span>) </span>
<span id="cb5-42"><a href="#cb5-42"></a>            pv &lt;-<span class="st"> </span><span class="cf">if</span> (obs <span class="op">&lt;=</span><span class="st"> </span>ei) </span>
<span id="cb5-43"><a href="#cb5-43"></a>                <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pv <span class="cf">else</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pv)</span>
<span id="cb5-44"><a href="#cb5-44"></a>        <span class="cf">if</span> (alternative <span class="op">==</span><span class="st"> &quot;greater&quot;</span>) </span>
<span id="cb5-45"><a href="#cb5-45"></a>            pv &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pv</span>
<span id="cb5-46"><a href="#cb5-46"></a>        <span class="kw">list</span>(<span class="dt">observed =</span> obs, <span class="dt">expected =</span> ei, <span class="dt">sd =</span> sdi, <span class="dt">p.value =</span> pv)</span>
<span id="cb5-47"><a href="#cb5-47"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-48"><a href="#cb5-48"></a>        <span class="cf">if</span> (<span class="kw">dim</span>(weight)[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> </span><span class="kw">dim</span>(weight)[<span class="dv">2</span>]) </span>
<span id="cb5-49"><a href="#cb5-49"></a>            <span class="kw">stop</span>(<span class="st">&quot;&#39;weight&#39; must be a square matrix&quot;</span>)</span>
<span id="cb5-50"><a href="#cb5-50"></a>        n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb5-51"><a href="#cb5-51"></a>        <span class="cf">if</span> (<span class="kw">dim</span>(weight)[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> </span>n) </span>
<span id="cb5-52"><a href="#cb5-52"></a>            <span class="kw">stop</span>(<span class="st">&quot;&#39;weight&#39; must have as many rows as observations in &#39;x&#39;&quot;</span>)</span>
<span id="cb5-53"><a href="#cb5-53"></a>        ei &lt;-<span class="st"> </span><span class="dv">-1</span><span class="op">/</span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb5-54"><a href="#cb5-54"></a>        nas &lt;-<span class="st"> </span><span class="kw">is.na</span>(x)</span>
<span id="cb5-55"><a href="#cb5-55"></a>        <span class="cf">if</span> (<span class="kw">any</span>(nas)) {</span>
<span id="cb5-56"><a href="#cb5-56"></a>            <span class="cf">if</span> (na.rm) {</span>
<span id="cb5-57"><a href="#cb5-57"></a>                x &lt;-<span class="st"> </span>x[<span class="op">!</span>nas]</span>
<span id="cb5-58"><a href="#cb5-58"></a>                n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb5-59"><a href="#cb5-59"></a>                weight &lt;-<span class="st"> </span>weight[<span class="op">!</span>nas, <span class="op">!</span>nas]</span>
<span id="cb5-60"><a href="#cb5-60"></a>            } <span class="cf">else</span> {</span>
<span id="cb5-61"><a href="#cb5-61"></a>                <span class="kw">warning</span>(<span class="st">&quot;&#39;x&#39; has missing values: maybe you wanted to set na.rm = TRUE?&quot;</span>)</span>
<span id="cb5-62"><a href="#cb5-62"></a>                <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">observed =</span> <span class="ot">NA</span>, <span class="dt">expected =</span> ei, <span class="dt">sd =</span> <span class="ot">NA</span>, <span class="dt">p.value =</span> <span class="ot">NA</span>))</span>
<span id="cb5-63"><a href="#cb5-63"></a>            }</span>
<span id="cb5-64"><a href="#cb5-64"></a>        }</span>
<span id="cb5-65"><a href="#cb5-65"></a>        <span class="co"># ROWSUM &lt;- rowSums(weight) ROWSUM[ROWSUM == 0] &lt;- 1 weight &lt;- weight/ROWSUM</span></span>
<span id="cb5-66"><a href="#cb5-66"></a>        s &lt;-<span class="st"> </span><span class="kw">sum</span>(weight)</span>
<span id="cb5-67"><a href="#cb5-67"></a>        m &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</span>
<span id="cb5-68"><a href="#cb5-68"></a>        y &lt;-<span class="st"> </span>x <span class="op">-</span><span class="st"> </span>m</span>
<span id="cb5-69"><a href="#cb5-69"></a>        cv &lt;-<span class="st"> </span><span class="kw">sum</span>(weight <span class="op">*</span><span class="st"> </span>y <span class="op">%o%</span><span class="st"> </span>y)</span>
<span id="cb5-70"><a href="#cb5-70"></a>        v &lt;-<span class="st"> </span><span class="kw">sum</span>(y<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-71"><a href="#cb5-71"></a>        obs &lt;-<span class="st"> </span>(n<span class="op">/</span>s) <span class="op">*</span><span class="st"> </span>(cv<span class="op">/</span>v)</span>
<span id="cb5-72"><a href="#cb5-72"></a>        <span class="cf">if</span> (scaled) {</span>
<span id="cb5-73"><a href="#cb5-73"></a>            i.max &lt;-<span class="st"> </span>(n<span class="op">/</span>s) <span class="op">*</span><span class="st"> </span>(<span class="kw">sd</span>(<span class="kw">rowSums</span>(weight) <span class="op">*</span><span class="st"> </span>y)<span class="op">/</span><span class="kw">sqrt</span>(v<span class="op">/</span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)))</span>
<span id="cb5-74"><a href="#cb5-74"></a>            obs &lt;-<span class="st"> </span>obs<span class="op">/</span>i.max</span>
<span id="cb5-75"><a href="#cb5-75"></a>        }</span>
<span id="cb5-76"><a href="#cb5-76"></a>        S1 &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((weight <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(weight))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-77"><a href="#cb5-77"></a>        S2 &lt;-<span class="st"> </span><span class="kw">sum</span>((<span class="kw">apply</span>(weight, <span class="dv">1</span>, sum) <span class="op">+</span><span class="st"> </span><span class="kw">apply</span>(weight, <span class="dv">2</span>, sum))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb5-78"><a href="#cb5-78"></a>        s.sq &lt;-<span class="st"> </span>s<span class="op">^</span><span class="dv">2</span></span>
<span id="cb5-79"><a href="#cb5-79"></a>        k &lt;-<span class="st"> </span>(<span class="kw">sum</span>(y<span class="op">^</span><span class="dv">4</span>)<span class="op">/</span>n)<span class="op">/</span>(v<span class="op">/</span>n)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb5-80"><a href="#cb5-80"></a>        sdi &lt;-<span class="st"> </span><span class="kw">sqrt</span>((n <span class="op">*</span><span class="st"> </span>((n<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>S1 <span class="op">-</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span>S2 <span class="op">+</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>s.sq) <span class="op">-</span><span class="st"> </span>k <span class="op">*</span><span class="st"> </span>(n <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>S1 <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span></span>
<span id="cb5-81"><a href="#cb5-81"></a><span class="st">            </span>S2 <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">*</span><span class="st"> </span>s.sq))<span class="op">/</span>((n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>s.sq) <span class="op">-</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>((n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb5-82"><a href="#cb5-82"></a>        alternative &lt;-<span class="st"> </span><span class="kw">match.arg</span>(alternative, <span class="kw">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;less&quot;</span>, <span class="st">&quot;greater&quot;</span>))</span>
<span id="cb5-83"><a href="#cb5-83"></a>        pv &lt;-<span class="st"> </span><span class="kw">pnorm</span>(obs, <span class="dt">mean =</span> ei, <span class="dt">sd =</span> sdi)</span>
<span id="cb5-84"><a href="#cb5-84"></a>        <span class="cf">if</span> (alternative <span class="op">==</span><span class="st"> &quot;two.sided&quot;</span>) </span>
<span id="cb5-85"><a href="#cb5-85"></a>            pv &lt;-<span class="st"> </span><span class="cf">if</span> (obs <span class="op">&lt;=</span><span class="st"> </span>ei) </span>
<span id="cb5-86"><a href="#cb5-86"></a>                <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pv <span class="cf">else</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pv)</span>
<span id="cb5-87"><a href="#cb5-87"></a>        <span class="cf">if</span> (alternative <span class="op">==</span><span class="st"> &quot;greater&quot;</span>) </span>
<span id="cb5-88"><a href="#cb5-88"></a>            pv &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pv</span>
<span id="cb5-89"><a href="#cb5-89"></a>        <span class="kw">list</span>(<span class="dt">observed =</span> obs, <span class="dt">expected =</span> ei, <span class="dt">sd =</span> sdi, <span class="dt">p.value =</span> pv)</span>
<span id="cb5-90"><a href="#cb5-90"></a>    }</span>
<span id="cb5-91"><a href="#cb5-91"></a>    </span>
<span id="cb5-92"><a href="#cb5-92"></a>    </span>
<span id="cb5-93"><a href="#cb5-93"></a>}</span></code></pre></div>
<p><code>fanscsv</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>fanscsv &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">ans =</span> ans, <span class="dt">filename =</span> <span class="st">&quot;ans.csv&quot;</span>, <span class="dt">write =</span> <span class="ot">TRUE</span>) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>    ans1_mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="kw">length</span>(ans<span class="op">$</span>effects[, <span class="dv">2</span>]), <span class="dt">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="kw">row.names</span>(ans1_mat) &lt;-<span class="st"> </span>ans<span class="op">$</span>effects[, <span class="dv">2</span>]</span>
<span id="cb6-4"><a href="#cb6-4"></a>    ans1_mat[, <span class="dv">1</span>] &lt;-<span class="st"> </span>(ans<span class="op">$</span>theta)</span>
<span id="cb6-5"><a href="#cb6-5"></a>    ans1_mat[, <span class="dv">2</span>] &lt;-<span class="st"> </span>(ans<span class="op">$</span>se)</span>
<span id="cb6-6"><a href="#cb6-6"></a>    ans1_mat[, <span class="dv">3</span>] &lt;-<span class="st"> </span>(ans<span class="op">$</span>tconv)</span>
<span id="cb6-7"><a href="#cb6-7"></a>    ans1_mat &lt;-<span class="st"> </span><span class="kw">rbind</span>(ans1_mat, <span class="kw">c</span>(ans<span class="op">$</span>tconv.max))</span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="kw">row.names</span>(ans1_mat)[<span class="kw">length</span>(<span class="kw">row.names</span>(ans1_mat))] &lt;-<span class="st"> &quot;Overall maximum convergence ratio:&quot;</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="kw">colnames</span>(ans1_mat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;Standard Error&quot;</span>, <span class="st">&quot;Convergence t-ratio&quot;</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="kw">print</span>(ans1_mat)</span>
<span id="cb6-11"><a href="#cb6-11"></a>    <span class="cf">if</span> (write) {</span>
<span id="cb6-12"><a href="#cb6-12"></a>        <span class="kw">write.csv</span>(ans1_mat, filename)</span>
<span id="cb6-13"><a href="#cb6-13"></a>    }</span>
<span id="cb6-14"><a href="#cb6-14"></a>}</span></code></pre></div>
</div>
<div id="data" class="section level2">
<h2><span class="header-section-number">3.2</span> Data</h2>
<p>We are going to play with a subsample of the MyMovez data. The original data are stored at the <a href="https://doi.org/10.17026/dans-zz9-gn44">Data Archiving and Networked Services</a>.</p>
<p><strong>Download data <a href="beh_data.Rdata">here</a>.</strong></p>
<p>Load the Robject and have a look at it.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">load</span>(<span class="st">&quot;beh_data.RData&quot;</span>)  <span class="co">#change to your working directory</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">str</span>(ExData, <span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">str</span>(ExData<span class="op">$</span>depvars, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## List of 8
##  $ nodeSets         :List of 1
##  $ observations     : int 3
##  $ depvars          :List of 3
##  $ cCovars          :List of 4
##  $ vCovars          :List of 1
##  $ dycCovars        : list()
##  $ dyvCovars        : list()
##  $ compositionChange: list()
##  - attr(*, &quot;higher&quot;)= Named logi [1:9] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   ..- attr(*, &quot;names&quot;)= chr [1:9] &quot;friendship,friendship&quot; &quot;advice,friendship&quot; &quot;mvpa_y,friendship&quot; &quot;friendship,advice&quot; ...
##  - attr(*, &quot;disjoint&quot;)= Named logi [1:9] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   ..- attr(*, &quot;names&quot;)= chr [1:9] &quot;friendship,friendship&quot; &quot;advice,friendship&quot; &quot;mvpa_y,friendship&quot; &quot;friendship,advice&quot; ...
##  - attr(*, &quot;atLeastOne&quot;)= Named logi [1:9] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   ..- attr(*, &quot;names&quot;)= chr [1:9] &quot;friendship,friendship&quot; &quot;advice,friendship&quot; &quot;mvpa_y,friendship&quot; &quot;friendship,advice&quot; ...
##  - attr(*, &quot;class&quot;)= chr &quot;siena&quot;
## List of 3
##  $ friendship: &#39;sienaDependent&#39; num [1:149, 1:149, 1:3] 0 1 0 1 1 1 0 0 0 0 ...
##   ..- attr(*, &quot;type&quot;)= chr &quot;oneMode&quot;
##   ..- attr(*, &quot;sparse&quot;)= logi FALSE
##   ..- attr(*, &quot;nodeSet&quot;)= chr &quot;Actors&quot;
##   ..- attr(*, &quot;netdims&quot;)= int [1:3] 149 149 3
##   ..- attr(*, &quot;allowOnly&quot;)= logi TRUE
##   ..- attr(*, &quot;uponly&quot;)= logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;downonly&quot;)= logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;distance&quot;)= int [1:2] 527 527
##   ..- attr(*, &quot;vals&quot;)=List of 3
##   ..- attr(*, &quot;nval&quot;)= int [1:3] 21580 21609 21579
##   ..- attr(*, &quot;noMissing&quot;)= num [1:3] 472 443 473
##   ..- attr(*, &quot;noMissingEither&quot;)= num [1:2] 489 473
##   ..- attr(*, &quot;nonMissingEither&quot;)= num [1:2] 21563 21579
##   ..- attr(*, &quot;balmean&quot;)= num 0.0908
##   ..- attr(*, &quot;structmean&quot;)= num 0.0902
##   ..- attr(*, &quot;simMean&quot;)= logi NA
##   ..- attr(*, &quot;symmetric&quot;)= logi FALSE
##   ..- attr(*, &quot;missing&quot;)= logi TRUE
##   ..- attr(*, &quot;structural&quot;)= logi TRUE
##   ..- attr(*, &quot;range2&quot;)= num [1:2] 0 1
##   ..- attr(*, &quot;ones&quot;)= Named int [1:3] 960 1102 967
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;1&quot; &quot;1&quot; &quot;1&quot;
##   ..- attr(*, &quot;density&quot;)= Named num [1:3] 0.0445 0.051 0.0448
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;1&quot; &quot;1&quot; &quot;1&quot;
##   ..- attr(*, &quot;degree&quot;)= Named num [1:3] 6.58 7.55 6.63
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;1&quot; &quot;1&quot; &quot;1&quot;
##   ..- attr(*, &quot;averageOutDegree&quot;)= num 6.92
##   ..- attr(*, &quot;averageInDegree&quot;)= num 6.92
##   ..- attr(*, &quot;maxObsOutDegree&quot;)= num [1:3] 27 27 27
##   ..- attr(*, &quot;missings&quot;)= num [1:3] 0.0214 0.0201 0.0214
##   ..- attr(*, &quot;name&quot;)= chr &quot;friendship&quot;
##  $ advice    : &#39;sienaDependent&#39; num [1:149, 1:149, 1:3] 0 0 0 0 0 0 0 0 0 0 ...
##   ..- attr(*, &quot;type&quot;)= chr &quot;oneMode&quot;
##   ..- attr(*, &quot;sparse&quot;)= logi FALSE
##   ..- attr(*, &quot;nodeSet&quot;)= chr &quot;Actors&quot;
##   ..- attr(*, &quot;netdims&quot;)= int [1:3] 149 149 3
##   ..- attr(*, &quot;allowOnly&quot;)= logi TRUE
##   ..- attr(*, &quot;uponly&quot;)= logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;downonly&quot;)= logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;distance&quot;)= int [1:2] 390 295
##   ..- attr(*, &quot;vals&quot;)=List of 3
##   ..- attr(*, &quot;nval&quot;)= int [1:3] 21576 21609 21577
##   ..- attr(*, &quot;noMissing&quot;)= num [1:3] 476 443 475
##   ..- attr(*, &quot;noMissingEither&quot;)= num [1:2] 493 475
##   ..- attr(*, &quot;nonMissingEither&quot;)= num [1:2] 21559 21577
##   ..- attr(*, &quot;balmean&quot;)= num 0.03
##   ..- attr(*, &quot;structmean&quot;)= num 0.0297
##   ..- attr(*, &quot;simMean&quot;)= logi NA
##   ..- attr(*, &quot;symmetric&quot;)= logi FALSE
##   ..- attr(*, &quot;missing&quot;)= logi TRUE
##   ..- attr(*, &quot;structural&quot;)= logi TRUE
##   ..- attr(*, &quot;range2&quot;)= num [1:2] 0 1
##   ..- attr(*, &quot;ones&quot;)= Named int [1:3] 362 294 201
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;1&quot; &quot;1&quot; &quot;1&quot;
##   ..- attr(*, &quot;density&quot;)= Named num [1:3] 0.01678 0.01361 0.00932
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;1&quot; &quot;1&quot; &quot;1&quot;
##   ..- attr(*, &quot;degree&quot;)= Named num [1:3] 2.48 2.01 1.38
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;1&quot; &quot;1&quot; &quot;1&quot;
##   ..- attr(*, &quot;averageOutDegree&quot;)= num 1.96
##   ..- attr(*, &quot;averageInDegree&quot;)= num 1.96
##   ..- attr(*, &quot;maxObsOutDegree&quot;)= num [1:3] 17 27 17
##   ..- attr(*, &quot;missings&quot;)= num [1:3] 0.0216 0.0201 0.0215
##   ..- attr(*, &quot;name&quot;)= chr &quot;advice&quot;
##  $ mvpa_y    : &#39;sienaDependent&#39; num [1:149, 1, 1:3] 1 NA 4 NA 2 1 NA 1 2 3 ...
##   ..- attr(*, &quot;type&quot;)= chr &quot;behavior&quot;
##   ..- attr(*, &quot;sparse&quot;)= logi FALSE
##   ..- attr(*, &quot;nodeSet&quot;)= chr &quot;Actors&quot;
##   ..- attr(*, &quot;netdims&quot;)= int [1:3] 149 1 3
##   ..- attr(*, &quot;allowOnly&quot;)= logi TRUE
##   ..- attr(*, &quot;uponly&quot;)= logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;downonly&quot;)= logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;distance&quot;)= num [1:2] 105 109
##   ..- attr(*, &quot;vals&quot;)=List of 3
##   ..- attr(*, &quot;nval&quot;)= int [1:3] 102 113 90
##   ..- attr(*, &quot;noMissing&quot;)= int [1:3] 47 36 59
##   ..- attr(*, &quot;noMissingEither&quot;)= num [1:2] 59 69
##   ..- attr(*, &quot;nonMissingEither&quot;)= num [1:2] 90 80
##   ..- attr(*, &quot;symmetric&quot;)= logi NA
##   ..- attr(*, &quot;poszvar&quot;)= logi TRUE
##   ..- attr(*, &quot;range&quot;)= num 4
##   ..- attr(*, &quot;range2&quot;)= num [1:2] 1 5
##   ..- attr(*, &quot;moreThan2&quot;)= logi TRUE
##   ..- attr(*, &quot;modes&quot;)= num [1:3] 2 4 1
##   ..- attr(*, &quot;missing&quot;)= logi TRUE
##   ..- attr(*, &quot;simMean&quot;)= num 0.622
##   ..- attr(*, &quot;structural&quot;)= logi FALSE
##   ..- attr(*, &quot;balmean&quot;)= logi NA
##   ..- attr(*, &quot;structmean&quot;)= logi NA
##   ..- attr(*, &quot;name&quot;)= chr &quot;mvpa_y&quot;
##   ..- attr(*, &quot;simMeans&quot;)= Named num [1:2] 0.849 0.773
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;friendship&quot; &quot;advice&quot;</code></pre>
<p>What do we have?</p>
<ul>
<li>Data on 7 classes. See below how to play with just one class.</li>
<li>friendship: dependent tie-variable: who are your friends</li>
<li>advice: dependent tie-variable: I am not telling you if it is ‘to whom do you give advice?’ or ‘from whom do you receive advice?’ that would make for a nice question on the exam.<br />
</li>
<li>mvpa_y: behavioral dependent variable ‘moderate to vigorous physical activity’ measured via FitBit. I made five categories (from low to high)</li>
<li>ethnicNLNA: a covariate (including missing values) on ethnicity of pupils: 0 is native Dutch; 1 is other ethnic background.</li>
<li>sex: sex of pupils: 0 is boys; 1 is girls.</li>
<li>lft: age of pupils (measured in years)</li>
<li>primary: primary school (grade 8) or secondary school (grade 9)</li>
<li>mvpa_x: please ignore this variable for now.</li>
</ul>
</div>
<div id="descriptive-statistics-of-similarity-in-behavior" class="section level2">
<h2><span class="header-section-number">3.3</span> Descriptive statistics of similarity in behavior</h2>
<p>On the <a href="../socio6">previous page</a> we focused on tie evolution and selection processes. We started the lab exercise with descriptive statistics on homophily and segregation. Are similar people more likely to be connected. We now take a slightly different angle. We want to know if nodes who are closer to one another in the network are more a like.<br />
“Hey, that sounds like some sort of correlation!” Yup, we need some spatial autocorrelation measure. Let us use Moran’s I for this.<br />
We will start with a calculation of the correlation between the score of actor i and the (total/mean) score of the alters of i to whom i is connected directly.</p>
<p>Spatial autocorrelation measures are actually quite complex. A lot of build in functions in different packages of R are not very clear on all the defaults. With respect to Moran’s I, its values are actually quite difficult to compare across different spatial/network settings. Results may depend heavily on whether or not you demean your variables of interest, the chosen neighborhood/weight matrix (and hence on distance decay functions and type of standardization of the weight matrix). Anyways, lets get started.</p>
<div id="formula" class="section level3">
<h3><span class="header-section-number">3.3.1</span> formula</h3>
<p>Moran’s I is given by:</p>
<p><span class="math display">\[ I= \gamma \Sigma_i\Sigma_jw_{ij}z_iz_j,\]</span>
where <span class="math inline">\(w_{ij}\)</span> is the weight matrix <span class="math inline">\(z_i\)</span> and <span class="math inline">\(z_j\)</span> are the scores in deviations from the mean. And,</p>
<p><span class="math display">\[ \gamma= S_0 * m_2 = \Sigma_i\Sigma_jw_{ij} * \frac{\Sigma_iz_i^2}{n},  \]</span>
Thus <span class="math inline">\(S_0\)</span> is the sum of the weight matrix and <span class="math inline">\(m_2\)</span> is an estimate of the variance. For more information see <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1111/j.1538-4632.1995.tb00338.x">Anselin 1995</a>.</p>
</div>
<div id="morans-autocorrelation-for-outgoing-ties-rsiena-build-in-dataset" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Moran’s autocorrelation for outgoing ties: RSiena build-in dataset</h3>
<p>We need two packages, if we not want to define all functions ourselves: <code>sna</code> and <code>ape</code>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Let us first demonstrate the concept on the build-in dataset of RSiena and then apply it to our own data.</p>
<p>First use <code>sna</code>. And give alters a weight of 1 if they are part of the 1.0 degree egocentric network.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">library</span>(network)</span>
<span id="cb9-2"><a href="#cb9-2"></a>friend.data.w1 &lt;-<span class="st"> </span>s501</span>
<span id="cb9-3"><a href="#cb9-3"></a>friend.data.w2 &lt;-<span class="st"> </span>s502</span>
<span id="cb9-4"><a href="#cb9-4"></a>friend.data.w3 &lt;-<span class="st"> </span>s503</span>
<span id="cb9-5"><a href="#cb9-5"></a>drink &lt;-<span class="st"> </span>s50a</span>
<span id="cb9-6"><a href="#cb9-6"></a>smoke &lt;-<span class="st"> </span>s50s</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>net1 &lt;-<span class="st"> </span>network<span class="op">::</span><span class="kw">as.network</span>(friend.data.w1)</span>
<span id="cb9-9"><a href="#cb9-9"></a>net2 &lt;-<span class="st"> </span>network<span class="op">::</span><span class="kw">as.network</span>(friend.data.w2)</span>
<span id="cb9-10"><a href="#cb9-10"></a>net3 &lt;-<span class="st"> </span>network<span class="op">::</span><span class="kw">as.network</span>(friend.data.w3)</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co"># nacf does not row standardize!</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>snam1 &lt;-<span class="st"> </span><span class="kw">nacf</span>(net1, drink[, <span class="dv">1</span>], <span class="dt">type =</span> <span class="st">&quot;moran&quot;</span>, <span class="dt">neighborhood.type =</span> <span class="st">&quot;out&quot;</span>, <span class="dt">demean =</span> <span class="ot">TRUE</span>)</span>
<span id="cb9-14"><a href="#cb9-14"></a>snam1[<span class="dv">2</span>]  <span class="co">#the first order matrix is stored in second list-element</span></span></code></pre></div>
<pre><code>##         1 
## 0.4331431</code></pre>
<p>Lets calculate the same thing with <code>ape</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>geodistances &lt;-<span class="st"> </span><span class="kw">geodist</span>(net1, <span class="dt">count.paths =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>geodistances &lt;-<span class="st"> </span>geodistances<span class="op">$</span>gdist</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># first define a nb based on distance 1.</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>weights1 &lt;-<span class="st"> </span>geodistances <span class="op">==</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co"># this function rowstandardizes by default</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>ape<span class="op">::</span><span class="kw">Moran.I</span>(drink[, <span class="dv">1</span>], <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">weight =</span> weights1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $observed
## [1] 0.486134
## 
## $expected
## [1] -0.02040816
## 
## $sd
## [1] 0.132727
## 
## $p.value
## [1] 0.000135401</code></pre>
<p>Close but not the same value!</p>
<p>Lets use ‘my own’ function, don’t rowstandardize</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">fMoran.I</span>(drink[, <span class="dv">1</span>], <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">weight =</span> weights1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">rowstandardize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## $observed
## [1] 0.4331431
## 
## $expected
## [1] -0.02040816
## 
## $sd
## [1] 0.1181079
## 
## $p.value
## [1] 0.000122962</code></pre>
<p>Same result as nacf function!</p>
<p>What does rowstandardization mean??</p>
<ul>
<li><strong>rowstandardize</strong>: We assume that each node <em>i</em> is influenced equally by its neighbourhood regardless on how large it. You could compare this to the average alter effect in RSiena)<br />
</li>
<li><strong>not rowstandardize</strong>: We assume that each alter <em>j</em> has the same influence on <em>i</em> (if at the same distance). You could compare this to the total alter effect in RSiena.</li>
</ul>
<p>To not standardize is default in <code>sna::nacf</code>, to standardize is default in <code>apa::Moran.I</code>. This bugs me. I thus made a small adaption to <code>apa::Moran.I</code> and now in the function <code>fMoran.I</code> you can choose if you want to rowstandardize or not.</p>
<p>But…</p>
<blockquote>
<p>“What you really, really want<br />
I wanna, (ha) I wanna, (ha)<br />
I wanna, (ha) I wanna, (ha)<br />
I wanna really, really, really<br />
Wanna zigazig ah”<br />
— Spice Girls - Wannabe</p>
</blockquote>
<p>What I really would like to see is a correlation between actor <em>i</em> and all the alters to whom it is connected (direct or indirectly) and where alters at a larger distances (longer shortest path lengths) are weighted less.</p>
<p>step 1: for each acter <em>i</em> determine the distances (shortest path lengths) to all other nodes in the network.
step 2: based on these distances decide on how we want to weigh. That is, determine a distance decay function.<br />
step 3: decide whether or not we want to row-standardize.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># step 1: calculate distances</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>geodistances &lt;-<span class="st"> </span><span class="kw">geodist</span>(net1, <span class="dt">count.paths =</span> <span class="ot">TRUE</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>geodistances &lt;-<span class="st"> </span>geodistances<span class="op">$</span>gdist</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># set the distance to yourself as Inf</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw">diag</span>(geodistances) &lt;-<span class="st"> </span><span class="ot">Inf</span></span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co"># step 2: define a distance decay function. This one is pretty standard in the spatial</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co"># autocorrelation literature but actually pretty arbitrary.</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>weights2 &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>geodistances)</span>
<span id="cb15-11"><a href="#cb15-11"></a></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co"># step 3: I dont want to rowstandardize.</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="kw">fMoran.I</span>(drink[, <span class="dv">1</span>], <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">weight =</span> weights2, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">rowstandardize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## $observed
## [1] 0.2817188
## 
## $expected
## [1] -0.02040816
## 
## $sd
## [1] 0.07532918
## 
## $p.value
## [1] 6.052458e-05</code></pre>
<p>Conclusion: Yes pupils closer to one another are more a like! And ‘closer’ here means a shorter shortest path length. You also observe that the correlation is lower than we calculated previously. Apparently, we are a like to alters very close by (path length one) and less so (or even dissimilar) to alters furter off.vvv</p>
</div>
<div id="morans-autocorrelation-for-outgoing-ties-mymovez-dataset" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Moran’s autocorrelation for outgoing ties: MyMovez dataset</h3>
<p>Let’s repeat the exercise but now on our own data. The tie variable we will use are the friendship relations.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># step 1: calculate distances</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>fnet &lt;-<span class="st"> </span>ExData<span class="op">$</span>depvars<span class="op">$</span>friendship[, , <span class="dv">1</span>]</span>
<span id="cb17-3"><a href="#cb17-3"></a>fnet[fnet <span class="op">==</span><span class="st"> </span><span class="dv">10</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a>geodistances &lt;-<span class="st"> </span><span class="kw">geodist</span>(fnet, <span class="dt">count.paths =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a>geodistances &lt;-<span class="st"> </span>geodistances<span class="op">$</span>gdist</span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># set the distance to yourself as Inf</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="kw">diag</span>(geodistances) &lt;-<span class="st"> </span><span class="ot">Inf</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co"># head(geodistances) #have a look for yourself.</span></span>
<span id="cb17-10"><a href="#cb17-10"></a></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="co"># step 2: define a distance decay function. This one is pretty standard in the spatial</span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co"># autocorrelation literature but actually pretty arbitrary.</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>weights2 &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>geodistances)</span>
<span id="cb17-14"><a href="#cb17-14"></a></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="co"># step 3: In this case I do want to rowstandardize because I think the influence is by the total</span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="co"># class but class sizes vary.</span></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="kw">fMoran.I</span>(ExData<span class="op">$</span>depvars<span class="op">$</span>mvpa_y[, , <span class="dv">1</span>], <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">weight =</span> weights2, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">rowstandardize =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $observed
## [1] 0.07961828
## 
## $expected
## [1] -0.006756757
## 
## $sd
## [1] 0.04212021
## 
## $p.value
## [1] 0.04029821</code></pre>
<p>Thus Yes, If we look at all classes together we see that pupils who are closer to one another are more a like with respect to physical activity. But the correlations is quite small!</p>
<p>Do we see the same within each class?</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># some background info:</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>nclass &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">25</span>, <span class="dv">24</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a>classid &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">times =</span> nclass)</span>
<span id="cb19-4"><a href="#cb19-4"></a></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="kw">print</span>(<span class="st">&quot;Moran&#39;s I: class 1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Moran&#39;s I: class 1&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">fMoran.I</span>(ExData<span class="op">$</span>depvars<span class="op">$</span>mvpa_y[, , <span class="dv">1</span>][<span class="dv">1</span><span class="op">:</span><span class="dv">28</span>], <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">weight =</span> weights2[<span class="dv">1</span><span class="op">:</span><span class="dv">28</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">28</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, </span>
<span id="cb21-2"><a href="#cb21-2"></a>    <span class="dt">rowstandardize =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $observed
## [1] -0.03002763
## 
## $expected
## [1] -0.03703704
## 
## $sd
## [1] 0.02435121
## 
## $p.value
## [1] 0.7734643</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">print</span>(<span class="st">&quot;Moran&#39;s I: class 2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Moran&#39;s I: class 2&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">fMoran.I</span>(ExData<span class="op">$</span>depvars<span class="op">$</span>mvpa_y[, , <span class="dv">1</span>][<span class="dv">29</span><span class="op">:</span><span class="dv">46</span>], <span class="dt">scaled =</span> <span class="ot">FALSE</span>, <span class="dt">weight =</span> weights2[<span class="dv">29</span><span class="op">:</span><span class="dv">46</span>, <span class="dv">29</span><span class="op">:</span><span class="dv">46</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, </span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="dt">rowstandardize =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $observed
## [1] 0.04152623
## 
## $expected
## [1] -0.05882353
## 
## $sd
## [1] 0.053813
## 
## $p.value
## [1] 0.06221135</code></pre>
<p>Correlations within classes are somewhat lower and/or not significant. Probably there is thus also similarity beween pupils because they are in the same class (might be due to selection and influence processes, or class/context effects of course).</p>
</div>
</div>
<div id="a-quick-co-evolution-rsiena-model-to-check." class="section level2">
<h2><span class="header-section-number">3.4</span> A quick co-evolution RSiena model to check.</h2>
<p>{{% alert note %}}</p>
<p>Please be aware that in co-evolution models (as in multiplex models) the variables defined as dependent variables in your RSiena data object can be both a ‘cause’ (or independent variable) and a ‘consequence’ (or dependent variable). In this influence effect: <code>includeEffects(myEff, name = "drinkingbeh", outdeg,    interaction1= "friendship" )</code> the dependent variable “drinkingbeh” is define by <code>name</code>, the independent networkvariable “friendship” by <code>interaction</code>.
{{% / alert %}}</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Step 1: DATA</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>friend.data.w1 &lt;-<span class="st"> </span>s501</span>
<span id="cb27-3"><a href="#cb27-3"></a>friend.data.w2 &lt;-<span class="st"> </span>s502</span>
<span id="cb27-4"><a href="#cb27-4"></a>friend.data.w3 &lt;-<span class="st"> </span>s503</span>
<span id="cb27-5"><a href="#cb27-5"></a>drink &lt;-<span class="st"> </span>s50a</span>
<span id="cb27-6"><a href="#cb27-6"></a>smoke &lt;-<span class="st"> </span>s50s</span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a>friendship &lt;-<span class="st"> </span><span class="kw">sienaDependent</span>(<span class="kw">array</span>(<span class="kw">c</span>(friend.data.w1, friend.data.w2, friend.data.w3), <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>, </span>
<span id="cb27-9"><a href="#cb27-9"></a>    <span class="dv">3</span>)))  <span class="co"># create tie-dependent variable</span></span>
<span id="cb27-10"><a href="#cb27-10"></a></span>
<span id="cb27-11"><a href="#cb27-11"></a>drinkingbeh &lt;-<span class="st"> </span><span class="kw">sienaDependent</span>(drink, <span class="dt">type =</span> <span class="st">&quot;behavior&quot;</span>)  <span class="co"># create behavior-dependent variable</span></span>
<span id="cb27-12"><a href="#cb27-12"></a></span>
<span id="cb27-13"><a href="#cb27-13"></a>smoke1 &lt;-<span class="st"> </span><span class="kw">coCovar</span>(smoke[, <span class="dv">1</span>])  <span class="co">#covariate</span></span>
<span id="cb27-14"><a href="#cb27-14"></a></span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="co"># Define the data set and obtain the basic effects object</span></span>
<span id="cb27-16"><a href="#cb27-16"></a>myCoEvolutionData &lt;-<span class="st"> </span><span class="kw">sienaDataCreate</span>(friendship, smoke1, drinkingbeh)</span>
<span id="cb27-17"><a href="#cb27-17"></a></span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="co"># STEP 2: have a look at data.</span></span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="kw">print01Report</span>(myCoEvolutionData, <span class="dt">modelname =</span> <span class="st">&quot;s50_3_CoEvinit&quot;</span>)</span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="co"># look at the created file!!</span></span>
<span id="cb27-21"><a href="#cb27-21"></a></span>
<span id="cb27-22"><a href="#cb27-22"></a><span class="co"># STEP 3: Define effects</span></span>
<span id="cb27-23"><a href="#cb27-23"></a>myCoEvolutionEff &lt;-<span class="st"> </span><span class="kw">getEffects</span>(myCoEvolutionData)</span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="co"># effectsDocumentation(myCoEvolutionEff)</span></span>
<span id="cb27-25"><a href="#cb27-25"></a></span>
<span id="cb27-26"><a href="#cb27-26"></a><span class="co"># structural effects</span></span>
<span id="cb27-27"><a href="#cb27-27"></a>myCoEvolutionEff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(myCoEvolutionEff, transTrip, cycle3)</span>
<span id="cb27-28"><a href="#cb27-28"></a></span>
<span id="cb27-29"><a href="#cb27-29"></a><span class="co"># homophily effect for the constant covariate smoking</span></span>
<span id="cb27-30"><a href="#cb27-30"></a>myCoEvolutionEff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(myCoEvolutionEff, simX, <span class="dt">interaction1 =</span> <span class="st">&quot;smoke1&quot;</span>)</span>
<span id="cb27-31"><a href="#cb27-31"></a></span>
<span id="cb27-32"><a href="#cb27-32"></a><span class="co"># selection effect related to drinking behavior?</span></span>
<span id="cb27-33"><a href="#cb27-33"></a>myCoEvolutionEff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(myCoEvolutionEff, egoX, altX, simX, <span class="dt">interaction1 =</span> <span class="st">&quot;drinkingbeh&quot;</span>)</span>
<span id="cb27-34"><a href="#cb27-34"></a></span>
<span id="cb27-35"><a href="#cb27-35"></a><span class="co"># INFLUENCE PART!! inline with the above I use totAlt</span></span>
<span id="cb27-36"><a href="#cb27-36"></a>myCoEvolutionEff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(myCoEvolutionEff, <span class="dt">name =</span> <span class="st">&quot;drinkingbeh&quot;</span>, totAlt, <span class="dt">interaction1 =</span> <span class="st">&quot;friendship&quot;</span>)</span>
<span id="cb27-37"><a href="#cb27-37"></a></span>
<span id="cb27-38"><a href="#cb27-38"></a><span class="co"># Check what effects you have decided to include:</span></span>
<span id="cb27-39"><a href="#cb27-39"></a></span>
<span id="cb27-40"><a href="#cb27-40"></a>myCoEvolutionEff</span>
<span id="cb27-41"><a href="#cb27-41"></a></span>
<span id="cb27-42"><a href="#cb27-42"></a><span class="co"># STEP 4: define algorithm</span></span>
<span id="cb27-43"><a href="#cb27-43"></a>myCoEvAlgorithm &lt;-<span class="st"> </span><span class="kw">sienaAlgorithmCreate</span>(<span class="dt">projname =</span> <span class="st">&quot;s50CoEv_3&quot;</span>)</span>
<span id="cb27-44"><a href="#cb27-44"></a></span>
<span id="cb27-45"><a href="#cb27-45"></a><span class="co"># STEP 5: estimate the model</span></span>
<span id="cb27-46"><a href="#cb27-46"></a>(ans &lt;-<span class="st"> </span><span class="kw">siena07</span>(myCoEvAlgorithm, <span class="dt">data =</span> myCoEvolutionData, <span class="dt">effects =</span> myCoEvolutionEff))</span>
<span id="cb27-47"><a href="#cb27-47"></a></span>
<span id="cb27-48"><a href="#cb27-48"></a><span class="co"># use this function if you want to save as excel fanscsv(ans, write=FALSE) #uncomment if you want.</span></span></code></pre></div>
<pre><code>##   effectName          include fix   test  initialValue parm
## 1 transitive triplets TRUE    FALSE FALSE          0   0   
## 2 3-cycles            TRUE    FALSE FALSE          0   0   
##   effectName        include fix   test  initialValue parm
## 1 smoke1 similarity TRUE    FALSE FALSE          0   0   
##   effectName             include fix   test  initialValue parm
## 1 drinkingbeh alter      TRUE    FALSE FALSE          0   0   
## 2 drinkingbeh ego        TRUE    FALSE FALSE          0   0   
## 3 drinkingbeh similarity TRUE    FALSE FALSE          0   0   
##   effectName              include fix   test  initialValue parm
## 1 drinkingbeh total alter TRUE    FALSE FALSE          0   0   
##    name        effectName                          include fix   test  initialValue parm
## 1  friendship  constant friendship rate (period 1) TRUE    FALSE FALSE    4.69604   0   
## 2  friendship  constant friendship rate (period 2) TRUE    FALSE FALSE    4.32885   0   
## 3  friendship  outdegree (density)                 TRUE    FALSE FALSE   -1.46770   0   
## 4  friendship  reciprocity                         TRUE    FALSE FALSE    0.00000   0   
## 5  friendship  transitive triplets                 TRUE    FALSE FALSE    0.00000   0   
## 6  friendship  3-cycles                            TRUE    FALSE FALSE    0.00000   0   
## 7  friendship  smoke1 similarity                   TRUE    FALSE FALSE    0.00000   0   
## 8  friendship  drinkingbeh alter                   TRUE    FALSE FALSE    0.00000   0   
## 9  friendship  drinkingbeh ego                     TRUE    FALSE FALSE    0.00000   0   
## 10 friendship  drinkingbeh similarity              TRUE    FALSE FALSE    0.00000   0   
## 11 drinkingbeh rate drinkingbeh (period 1)         TRUE    FALSE FALSE    0.70571   0   
## 12 drinkingbeh rate drinkingbeh (period 2)         TRUE    FALSE FALSE    0.84939   0   
## 13 drinkingbeh drinkingbeh linear shape            TRUE    FALSE FALSE    0.32237   0   
## 14 drinkingbeh drinkingbeh quadratic shape         TRUE    FALSE FALSE    0.00000   0   
## 15 drinkingbeh drinkingbeh total alter             TRUE    FALSE FALSE    0.00000   0   
## siena07 will create an output file s50CoEv_3.txt .
## Estimates, standard errors and convergence t-ratios
## 
##                                                Estimate   Standard   Convergence 
##                                                             Error      t-ratio   
## Network Dynamics 
##    1. rate constant friendship rate (period 1)  6.4882  ( 1.0612   )    0.0049   
##    2. rate constant friendship rate (period 2)  5.1469  ( 0.8822   )   -0.0622   
##    3. eval outdegree (density)                 -2.7591  ( 0.1466   )   -0.0128   
##    4. eval reciprocity                          2.3797  ( 0.2145   )    0.0024   
##    5. eval transitive triplets                  0.6436  ( 0.1534   )   -0.0015   
##    6. eval 3-cycles                            -0.0667  ( 0.2987   )    0.0071   
##    7. eval smoke1 similarity                    0.1673  ( 0.2308   )   -0.0011   
##    8. eval drinkingbeh alter                   -0.0352  ( 0.1172   )   -0.0028   
##    9. eval drinkingbeh ego                      0.0630  ( 0.1145   )   -0.0474   
##   10. eval drinkingbeh similarity               1.3440  ( 0.6351   )    0.0205   
## 
## Behavior Dynamics
##   11. rate rate drinkingbeh (period 1)          1.2864  ( 0.3874   )   -0.0294   
##   12. rate rate drinkingbeh (period 2)          1.7911  ( 0.5739   )   -0.0642   
##   13. eval drinkingbeh linear shape             0.4151  ( 0.2293   )   -0.0146   
##   14. eval drinkingbeh quadratic shape         -0.5398  ( 0.2501   )   -0.0857   
##   15. eval drinkingbeh total alter              0.4262  ( 0.2220   )   -0.0030   
## 
## Overall maximum convergence ratio:    0.1936 
## 
## 
## Total of 3368 iteration steps.</code></pre>
<p>What would you conclude?</p>
<ul>
<li>Yes, we observe selection based on drinking.<br />
</li>
<li>Yes, we observe influence via the drinking behavior of befriended alters.</li>
</ul>
</div>
</div>
<div id="assignment" class="section level1">
<h1><span class="header-section-number">4</span> Assignment</h1>
<p><strong>Assignment:</strong> Formulate at least three research questions with respect to selection and influence effects among pupils with respect to physical activity. Test these effects on the MyMovez dataset.</p>
<ul>
<li>start with descriptive statistics<br />
</li>
<li>estimate subsequent models (at least three) and please motivate the order by which you include additional effects/variables<br />
</li>
<li>include at least two multiplex effects<br />
</li>
<li>include/try at least four behavioral-evolution effects</li>
</ul>
<div id="testing-and-finding-optimal-model" class="section level2">
<h2><span class="header-section-number">4.1</span> testing and finding optimal model</h2>
<p>You probably need to estimate quite some models. To speed things up, you may want to tweak your algorithm by <code>sienaAlgorithm</code> or you may want to run you models on a subsample first.</p>
<div id="sienaalgorithm" class="section level3">
<h3><span class="header-section-number">4.1.1</span> sienaAlgorithm</h3>
<p>Have a look at the function: <code>?sienaAlgorithm</code>. You could change n3 to 500 and nsub to 2.</p>
</div>
<div id="select-only-one-class" class="section level3">
<h3><span class="header-section-number">4.1.2</span> select only one class</h3>
<p>You may want to test your models first on one class only. When you are satisfied, you could run your models on the total class pool. In the code snippet below, you see how to select one class and make a new RSiena dataobject.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># these are the respective class sizes.</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>nclass &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">25</span>, <span class="dv">24</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a>classid &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">times =</span> nclass)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a>test &lt;-<span class="st"> </span>ExData[classid <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]  <span class="co">#change classid to select a different class. </span></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co"># because everything needs to be mean centered again also make sure to run the next command</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>class1 &lt;-<span class="st"> </span><span class="kw">sienaDataCreate</span>(test<span class="op">$</span>depvars<span class="op">$</span>friendship, test<span class="op">$</span>depvars<span class="op">$</span>advice, test<span class="op">$</span>depvars<span class="op">$</span>mvpa_y, test<span class="op">$</span>cCovars<span class="op">$</span>ethnicNLNA, </span>
<span id="cb29-8"><a href="#cb29-8"></a>    test<span class="op">$</span>cCovars<span class="op">$</span>sex, test<span class="op">$</span>cCovars<span class="op">$</span>lft, test<span class="op">$</span>cCovars<span class="op">$</span>primary, test<span class="op">$</span>vCovars<span class="op">$</span>mvpa_x)</span></code></pre></div>
</div>
</div>
<div id="an-example-on-the-mymovez-dataset" class="section level2">
<h2><span class="header-section-number">4.2</span> An example on the MyMovez dataset</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">require</span>(RSiena)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">require</span>(xtable)  <span class="co"># for some html output</span></span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co"># Step 1: DATA</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="kw">load</span>(<span class="st">&quot;beh_data.RData&quot;</span>)</span>
<span id="cb30-6"><a href="#cb30-6"></a>mydata &lt;-<span class="st"> </span>ExData</span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co"># Stept 2: some first summary</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="kw">print01Report</span>(mydata, <span class="dt">modelname =</span> <span class="st">&quot;segtest1&quot;</span>)</span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="co"># look at the printed doc!!</span></span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="co"># Step 3: set algorithm</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>myalgorithm &lt;-<span class="st"> </span><span class="kw">sienaAlgorithmCreate</span>(<span class="dt">projname =</span> <span class="st">&quot;segtest1&quot;</span>)</span></code></pre></div>
<pre><code>## siena07 will create an output file segtest1.txt .</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Step 4: set effects</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>NBeff &lt;-<span class="st"> </span><span class="kw">getEffects</span>(mydata)</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co"># have a look at all possible effects effectsDocumentation(NBeff) #uncomment if you want to have a</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co"># look</span></span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co"># possible order?  a: uncontrolled for network structure effects b: controlled for network structure</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co"># effects M1a/b: selection: homophily tendencies demographics: simsex, simethnic, M2a/b: selection:</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co"># homophily tendencies health: MVPA_y M3a/b: influence: on health M4: total</span></span>
<span id="cb32-9"><a href="#cb32-9"></a></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co"># I am just estimating the total model in this example.</span></span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co"># Structural effects only focus on friendship network in this example, thus specifying &#39;name&#39;</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co"># argument is not necessary.</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, inPop, transTrip, transRecTrip)</span></code></pre></div>
<pre><code>##   effectName                              include fix   test  initialValue parm
## 1 friendship: transitive triplets         TRUE    FALSE FALSE          0   0   
## 2 friendship: transitive recipr. triplets TRUE    FALSE FALSE          0   0   
## 3 friendship: indegree - popularity       TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># selection effects</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, egoX, altX, egoXaltX, <span class="dt">interaction1 =</span> <span class="st">&quot;ethnicNLNA&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName                                    include fix   test  initialValue parm
## 1 friendship: ethnicNLNA alter                  TRUE    FALSE FALSE          0   0   
## 2 friendship: ethnicNLNA ego                    TRUE    FALSE FALSE          0   0   
## 3 friendship: ethnicNLNA ego x ethnicNLNA alter TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, egoX, altX, sameX, <span class="dt">interaction1 =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName            include fix   test  initialValue parm
## 1 friendship: sex alter TRUE    FALSE FALSE          0   0   
## 2 friendship: sex ego   TRUE    FALSE FALSE          0   0   
## 3 friendship: same sex  TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, egoX, altX, absDiffX, <span class="dt">interaction1 =</span> <span class="st">&quot;mvpa_y&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName                         include fix   test  initialValue parm
## 1 friendship: mvpa_y alter           TRUE    FALSE FALSE          0   0   
## 2 friendship: mvpa_y ego             TRUE    FALSE FALSE          0   0   
## 3 friendship: mvpa_y abs. difference TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># behavioral model: node effects</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, effFrom, <span class="dt">name =</span> <span class="st">&quot;mvpa_y&quot;</span>, <span class="dt">interaction1 =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName              include fix   test  initialValue parm
## 1 mvpa_y: effect from sex TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, effFrom, <span class="dt">name =</span> <span class="st">&quot;mvpa_y&quot;</span>, <span class="dt">interaction1 =</span> <span class="st">&quot;lft&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName              include fix   test  initialValue parm
## 1 mvpa_y: effect from lft TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, effFrom, <span class="dt">name =</span> <span class="st">&quot;mvpa_y&quot;</span>, <span class="dt">interaction1 =</span> <span class="st">&quot;ethnicNLNA&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName                     include fix   test  initialValue parm
## 1 mvpa_y: effect from ethnicNLNA TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># influence effects</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>NBeff &lt;-<span class="st"> </span><span class="kw">includeEffects</span>(NBeff, totSimRecip, <span class="dt">name =</span> <span class="st">&quot;mvpa_y&quot;</span>, <span class="dt">interaction1 =</span> <span class="st">&quot;friendship&quot;</span>)</span></code></pre></div>
<pre><code>##   effectName                                  include fix   test  initialValue parm
## 1 mvpa_y tot. sim. x reciprocity (friendship) TRUE    FALSE FALSE          0   0</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># look at all effects</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>NBeff</span></code></pre></div>
<pre><code>##    name       effectName                                    include fix   test  initialValue parm
## 1  friendship constant friendship rate (period 1)           TRUE    FALSE FALSE    7.28417   0   
## 2  friendship constant friendship rate (period 2)           TRUE    FALSE FALSE    7.27877   0   
## 3  friendship friendship: outdegree (density)               TRUE    FALSE FALSE   -1.25979   0   
## 4  friendship friendship: reciprocity                       TRUE    FALSE FALSE    0.00000   0   
## 5  friendship friendship: transitive triplets               TRUE    FALSE FALSE    0.00000   0   
## 6  friendship friendship: transitive recipr. triplets       TRUE    FALSE FALSE    0.00000   0   
## 7  friendship friendship: indegree - popularity             TRUE    FALSE FALSE    0.00000   0   
## 8  friendship friendship: ethnicNLNA alter                  TRUE    FALSE FALSE    0.00000   0   
## 9  friendship friendship: ethnicNLNA ego                    TRUE    FALSE FALSE    0.00000   0   
## 10 friendship friendship: ethnicNLNA ego x ethnicNLNA alter TRUE    FALSE FALSE    0.00000   0   
## 11 friendship friendship: sex alter                         TRUE    FALSE FALSE    0.00000   0   
## 12 friendship friendship: sex ego                           TRUE    FALSE FALSE    0.00000   0   
## 13 friendship friendship: same sex                          TRUE    FALSE FALSE    0.00000   0   
## 14 friendship friendship: mvpa_y alter                      TRUE    FALSE FALSE    0.00000   0   
## 15 friendship friendship: mvpa_y ego                        TRUE    FALSE FALSE    0.00000   0   
## 16 friendship friendship: mvpa_y abs. difference            TRUE    FALSE FALSE    0.00000   0   
## 17 advice     constant advice rate (period 1)               TRUE    FALSE FALSE    5.39192   0   
## 18 advice     constant advice rate (period 2)               TRUE    FALSE FALSE    4.07544   0   
## 19 advice     advice: outdegree (density)                   TRUE    FALSE FALSE   -1.73553   0   
## 20 advice     advice: reciprocity                           TRUE    FALSE FALSE    0.00000   0   
## 21 mvpa_y     rate mvpa_y (period 1)                        TRUE    FALSE FALSE    2.17740   0   
## 22 mvpa_y     rate mvpa_y (period 2)                        TRUE    FALSE FALSE    2.87832   0   
## 23 mvpa_y     mvpa_y linear shape                           TRUE    FALSE FALSE    0.04291   0   
## 24 mvpa_y     mvpa_y quadratic shape                        TRUE    FALSE FALSE    0.00000   0   
## 25 mvpa_y     mvpa_y tot. sim. x reciprocity (friendship)   TRUE    FALSE FALSE    0.00000   0   
## 26 mvpa_y     mvpa_y: effect from ethnicNLNA                TRUE    FALSE FALSE    0.00000   0   
## 27 mvpa_y     mvpa_y: effect from sex                       TRUE    FALSE FALSE    0.00000   0   
## 28 mvpa_y     mvpa_y: effect from lft                       TRUE    FALSE FALSE    0.00000   0</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode numberSource r highlightt numberLines"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Please uncomment this section. I just don&#39;t want to reestimate the model. It does take a while.</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="co"># (ans &lt;- siena07( myalgorithm, data = ExData, effects = NBeff)) save(ans, file=&#39;ans.RData&#39;)</span></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="co"># siena.table(ans, type=&#39;html&#39;, tstat=T, d=2, sig=T)</span></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="kw">load</span>(<span class="st">&quot;ans.RData&quot;</span>)</span>
<span id="cb50-5"><a href="#cb50-5"></a>ans</span></code></pre></div>
<pre><code>## Estimates, standard errors and convergence t-ratios
## 
##                                                          Estimate   Standard   Convergence 
##                                                                       Error      t-ratio   
## Network Dynamics 
##    1. rate constant friendship rate (period 1)            5.2601  ( 0.3035   )   -0.0635   
##    2. rate constant friendship rate (period 2)            5.8955  ( 0.4876   )   -0.0676   
##    3. eval friendship: outdegree (density)                2.7341  ( 2.2175   )   -0.0638   
##    4. eval friendship: reciprocity                        2.9414  ( 1.8683   )   -0.1328   
##    5. eval friendship: transitive triplets                0.9225  ( 0.4882   )   -0.0978   
##    6. eval friendship: transitive recipr. triplets       -0.8119  ( 0.5046   )   -0.1375   
##    7. eval friendship: indegree - popularity             -0.2624  ( 0.1349   )   -0.0828   
##    8. eval friendship: ethnicNLNA alter                  -0.1208  ( 0.3393   )    0.0060   
##    9. eval friendship: ethnicNLNA ego                     0.0291  ( 0.3723   )   -0.0137   
##   10. eval friendship: ethnicNLNA ego x ethnicNLNA alter  0.0181  ( 0.9868   )   -0.0493   
##   11. eval friendship: mvpa_y alter                       0.0624  ( 0.5220   )    0.0570   
##   12. eval friendship: mvpa_y ego                        -0.3947  ( 0.3123   )   -0.0445   
##   13. eval friendship: mvpa_y abs. difference            -3.6551  ( 2.5637   )   -0.0319   
##   14. rate constant advice rate (period 1)                7.3773  ( 0.8998   )    0.0094   
##   15. rate constant advice rate (period 2)                5.4382  ( 0.5426   )   -0.0753   
##   16. eval advice: outdegree (density)                   -1.6276  ( 0.0679   )   -0.0297   
##   17. eval advice: reciprocity                            0.9398  ( 0.1646   )   -0.0359   
## 
## Behavior Dynamics
##   18. rate rate mvpa_y (period 1)                         8.6516  ( 3.4273   )   -0.0135   
##   19. rate rate mvpa_y (period 2)                        25.8909  ( 8.7388   )   -0.0022   
##   20. eval mvpa_y linear shape                           -0.0155  ( 0.0547   )    0.0096   
##   21. eval mvpa_y quadratic shape                         0.0934  ( 0.0701   )   -0.0931   
##   22. eval mvpa_y tot. sim. x reciprocity (friendship)    0.1675  ( 0.1606   )    0.0369   
##   23. eval mvpa_y: effect from ethnicNLNA                 0.2842  ( 0.0969   )    0.0263   
##   24. eval mvpa_y: effect from sex                       -0.1610  ( 0.0993   )   -0.0041   
##   25. eval mvpa_y: effect from lft                       -0.0595  ( 0.0309   )   -0.0271   
## 
## Overall maximum convergence ratio:    0.2810 
## 
## 
## Total of 3944 iteration steps.</code></pre>
<p>What would you conclude?</p>
<ul>
<li>The selection variable of interest is in the predicted direction but does not reach significance.
<ul>
<li>Should we model friendship selection based on mvpa_y with a different statistic/effect?<br />
</li>
<li>Would we observe the same with respect to advice relations?<br />
</li>
</ul></li>
<li>The influenc variable of interest is in the predicted direction but does not reach significance.
<ul>
<li>Should we model network influence on mvpa_y with a different statistic/effect?<br />
</li>
<li>Would we observe the same with respect to advice relations?</li>
</ul></li>
</ul>
<p>Hopefully, this example gives you enough pointers to make the assignment.</p>
<p>Latest Version: 12-12-2020</p>
<p>Please email any comments to: <a href="mailto:j.tolsma@ru.nl" class="email">j.tolsma@ru.nl</a></p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I quite frequently need to calculate Moran’s I and related statistics in my work/hobby. I commonly use the functions in the R package <code>spdep</code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
